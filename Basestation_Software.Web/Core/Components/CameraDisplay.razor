@inject CameraService _CameraController
@implements IDisposable

<link rel="stylesheet" type="text/css" href="CameraDisplay.razor.css?version=0.1">

<div class="card full-height">
    <div class="card-header">
        <h3>Camera Display</h3>
    </div>
    <div class="cam-container">
        <img class="cam-display" src="@_CameraController.GetFrameData()" />
    </div>
    <p>Component Content</p>
</div>

@code {
    private bool _prerendered = false;

    private async Task Update()
    {
        await InvokeAsync(StateHasChanged);
    }

    protected override async Task OnInitializedAsync()
    {
        // _CameraController.WatchForFrames();
        _CameraController.SubscribeToNewFrame(Update);
        await InvokeAsync(StateHasChanged);
    }

    void IDisposable.Dispose()
    {
        if (_prerendered)
        {
            _CameraController.UnsubscribeFromNewFrame(Update);
            _CameraController.Dispose();
        }
        else
        {
            _prerendered = true;
        }
    }
}
